# 1. Use an official Python base image
FROM python:3.12-slim
# Use the root as the context
WORKDIR /code

# Copy requirements from the backend folder
COPY ./requirements.txt .
RUN pip install --no-cache-dir -r requirements.txt

# Copy the backend code (which includes your static/ folder)
COPY ./backend /code/backend
RUN touch /code/backend/app/__init__.py

# Set the working directory to where your main.py is
WORKDIR /code/backend

# --host 0.0.0.0 is required to make it accessible outside the container
RUN pip install gunicorn uvicorn[standard]
CMD ["gunicorn", "main:app", "-w", "4", "-k", "uvicorn.workers.UvicornWorker", "-b", "0.0.0.0:80"]
